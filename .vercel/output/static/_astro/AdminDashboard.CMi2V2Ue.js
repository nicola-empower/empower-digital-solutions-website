import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.Cd_vQiNd.js";import{s as a}from"./supabase.D2FDowrI.js";function D(){const[m,h]=l.useState(!0),[n,u]=l.useState({clients:0,activeProjects:0,pendingActions:0}),[d,p]=l.useState([]),[c,b]=l.useState([]),[f,o]=l.useState(!1),[j,g]=l.useState([]),[s,r]=l.useState({clientId:"",name:"",workflow_type:"Social Media",status:"Pending"});l.useEffect(()=>{x()},[]);const x=async()=>{const{data:{session:t}}=await a.auth.getSession();if(!t){window.location.href="/admin";return}const{count:i}=await a.from("profiles").select("*",{count:"exact",head:!0}),{count:y}=await a.from("projects").select("*",{count:"exact",head:!0}).eq("status","Active"),{count:k}=await a.from("tasks").select("*",{count:"exact",head:!0}).eq("is_completed",!1).eq("type","client_task");u({clients:i||0,activeProjects:y||0,pendingActions:k||0});const{data:C}=await a.from("projects").select("*, profiles(full_name, company_name)").order("created_at",{ascending:!1});p(C||[]);const{data:S}=await a.from("activity_logs").select("*, projects(name)").order("created_at",{ascending:!1}).limit(5);b(S||[]),h(!1)},N=async()=>{await a.auth.signOut(),window.location.href="/admin"},w=async()=>{const{data:t}=await a.from("profiles").select("id, full_name, email");g(t||[]),o(!0)},v=async t=>{t.preventDefault();const{error:i}=await a.from("projects").insert({client_id:s.clientId,name:s.name,workflow_type:s.workflow_type,status:s.status,progress:0});i?alert("Error: "+i.message):(await a.from("activity_logs").insert({message:"Admin initialised new protocol."}),o(!1),x())};return m?e.jsx("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center text-white",children:"Loading Dashboard..."}):e.jsxs("div",{className:"min-h-screen bg-slate-950 flex",children:[e.jsxs("div",{className:"flex-1 p-8 overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Client Portal"}),e.jsx("p",{className:"text-slate-400",children:"Welcome back, Administrator."})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:N,className:"px-4 py-2 bg-slate-800 text-slate-300 rounded-lg hover:bg-slate-700 transition-colors",children:"Logout"}),e.jsx("button",{onClick:w,className:"px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors font-bold",children:"+ New Client"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-slate-900 p-6 rounded-xl border border-slate-800",children:[e.jsx("h3",{className:"text-slate-400 text-xs font-bold uppercase tracking-wider mb-2",children:"Total Clients"}),e.jsx("p",{className:"text-4xl font-bold text-white",children:n.clients})]}),e.jsxs("div",{className:"bg-slate-900 p-6 rounded-xl border border-slate-800",children:[e.jsx("h3",{className:"text-slate-400 text-xs font-bold uppercase tracking-wider mb-2",children:"Active Projects"}),e.jsx("p",{className:"text-4xl font-bold text-white",children:n.activeProjects})]}),e.jsxs("div",{className:"bg-slate-900 p-6 rounded-xl border border-slate-800",children:[e.jsx("h3",{className:"text-slate-400 text-xs font-bold uppercase tracking-wider mb-2",children:"Pending Actions"}),e.jsx("p",{className:"text-4xl font-bold text-white",children:n.pendingActions})]})]}),e.jsxs("div",{className:"bg-slate-900 rounded-xl border border-slate-800 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-slate-800",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"All Portfolios"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-950/50 text-slate-400 text-xs uppercase tracking-wider",children:[e.jsx("th",{className:"p-6 font-medium",children:"Client"}),e.jsx("th",{className:"p-6 font-medium",children:"Workflow"}),e.jsx("th",{className:"p-6 font-medium",children:"Progress"}),e.jsx("th",{className:"p-6 font-medium",children:"Status"}),e.jsx("th",{className:"p-6 font-medium text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-800",children:[d.map(t=>e.jsxs("tr",{className:"hover:bg-slate-800/50 transition-colors",children:[e.jsxs("td",{className:"p-6",children:[e.jsx("div",{className:"font-bold text-white",children:t.profiles?.full_name||"Unknown"}),e.jsx("div",{className:"text-sm text-slate-400",children:t.profiles?.company_name||"No Company"})]}),e.jsx("td",{className:"p-6",children:e.jsx("span",{className:"px-3 py-1 bg-slate-800 text-slate-300 rounded-full text-xs border border-slate-700",children:t.workflow_type||"General"})}),e.jsx("td",{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 h-2 bg-slate-800 rounded-full w-24 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-500 rounded-full",style:{width:`${t.progress}%`}})}),e.jsxs("span",{className:"text-sm text-slate-400",children:[t.progress,"%"]})]})}),e.jsx("td",{className:"p-6",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${t.status==="Active"?"bg-emerald-500/10 text-emerald-500 border border-emerald-500/20":t.status==="Pending"?"bg-amber-500/10 text-amber-500 border border-amber-500/20":"bg-slate-800 text-slate-400"}`,children:t.status})}),e.jsx("td",{className:"p-6 text-right",children:e.jsx("a",{href:`/admin/project/${t.id}`,className:"text-purple-400 hover:text-purple-300 font-medium text-sm",children:"Manage â†’"})})]},t.id)),d.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-8 text-center text-slate-500",children:"No active projects found."})})]})]})})]})]}),e.jsxs("div",{className:"w-80 bg-slate-900 border-l border-slate-800 p-6 hidden xl:block",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"font-bold text-white",children:"Live Updates"}),e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"})]}),e.jsxs("div",{className:"space-y-4",children:[c.map(t=>e.jsxs("div",{className:"bg-slate-950/50 p-4 rounded-lg border border-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-purple-400 uppercase tracking-wider",children:"System Alert"}),e.jsx("span",{className:"text-xs text-slate-500",children:new Date(t.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:"text-sm text-slate-300 leading-relaxed",children:t.message}),t.projects?.name&&e.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["Project: ",t.projects.name]})]},t.id)),c.length===0&&e.jsx("p",{className:"text-slate-500 text-sm text-center py-4",children:"No recent activity."})]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-slate-900 p-8 rounded-2xl border border-slate-800 w-full max-w-lg shadow-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Initialise New Protocol"}),e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Select Client"}),e.jsxs("select",{required:!0,className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500",value:s.clientId,onChange:t=>r({...s,clientId:t.target.value}),children:[e.jsx("option",{value:"",children:"Select a client..."}),j.map(t=>e.jsxs("option",{value:t.id,children:[t.full_name," (",t.email,")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Project Name"}),e.jsx("input",{type:"text",required:!0,placeholder:"e.g. Q4 Marketing Campaign",className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500",value:s.name,onChange:t=>r({...s,name:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Workflow Type"}),e.jsxs("select",{className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500",value:s.workflow_type,onChange:t=>r({...s,workflow_type:t.target.value}),children:[e.jsx("option",{children:"Social Media"}),e.jsx("option",{children:"Web Design"}),e.jsx("option",{children:"Consulting"}),e.jsx("option",{children:"Automation"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Initial Status"}),e.jsxs("select",{className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500",value:s.status,onChange:t=>r({...s,status:t.target.value}),children:[e.jsx("option",{children:"Pending"}),e.jsx("option",{children:"Active"})]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>o(!1),className:"flex-1 bg-slate-800 text-white font-bold py-3 rounded-lg hover:bg-slate-700 transition-colors",children:"Abort"}),e.jsx("button",{type:"submit",className:"flex-1 bg-emerald-600 text-white font-bold py-3 rounded-lg hover:bg-emerald-700 transition-colors",children:"Initialise"})]})]})]})})]})}export{D as default};
