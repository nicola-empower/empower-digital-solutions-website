import{j as e}from"./jsx-runtime.ClP7wGfN.js";import{r}from"./index.DK-fsZOb.js";import{s as a}from"./supabase.CJZAYlQe.js";import{F as W}from"./file-text.BxmPbMHG.js";import{C as j}from"./circle-check-big.DIjgcCMq.js";import{c as N}from"./createLucideIcon.BvVQPHGD.js";import{U as G}from"./upload.bV92bC9w.js";import{E as A}from"./external-link.CF0LS1WK.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],B=N("circle",J);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Z=N("download",Y);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Q=N("folder",K);function ne({demoMode:d=!1}){const[g,w]=r.useState(!d),[i,y]=r.useState(null),[m,p]=r.useState([]),[v,_]=r.useState([]),[x,k]=r.useState("overview"),[S,C]=r.useState(!1);r.useEffect(()=>{d?(y({id:"demo-123",name:"Demo Brand Redesign",status:"Active",progress:65}),p([{id:1,title:"Initial Consultation",is_completed:!0,type:"admin_task"},{id:2,title:"Brand Strategy Deck",is_completed:!0,type:"admin_task"},{id:3,title:"Logo Concepts",is_completed:!1,type:"admin_task"},{id:4,title:"Fill out Onboarding Form",is_completed:!0,type:"client_task"},{id:5,title:"Upload Brand Assets",is_completed:!1,type:"client_task"},{id:6,title:"Approve Moodboard",is_completed:!1,type:"client_task"}]),_([{id:1,name:"Contract_Signed.pdf",size:"1.2 MB",created_at:new Date().toISOString(),url:"#"},{id:2,name:"Brand_Guidelines_v1.pdf",size:"4.5 MB",created_at:new Date().toISOString(),url:"#"}]),w(!1)):u()},[d]);const u=async()=>{const{data:{session:t}}=await a.auth.getSession();if(!t){window.location.href="/portal";return}const{data:s}=await a.from("projects").select("*").eq("client_id",t.user.id).limit(1);if(s&&s.length>0){const l=s[0];y(l);const{data:n}=await a.from("tasks").select("*").eq("project_id",l.id).order("created_at",{ascending:!0});p(n||[]);const{data:f}=await a.from("documents").select("*").eq("project_id",l.id).order("created_at",{ascending:!1});_(f||[])}w(!1)},D=async()=>{if(d){alert("This is just a demo! In the real portal, this logs you out.");return}await a.auth.signOut(),window.location.href="/portal"},T=async t=>{if(d){alert("File upload is disabled in demo mode.");return}const s=t.target.files[0];if(!(!s||!i)){C(!0);try{const l=s.name.split(".").pop(),n=`${Math.random()}.${l}`,f=`${i.id}/${n}`,{error:q}=await a.storage.from("portal-files").upload(f,s);if(q)throw q;const{data:{publicUrl:V}}=a.storage.from("portal-files").getPublicUrl(f),{error:L}=await a.from("documents").insert({project_id:i.id,name:s.name,url:V,size:(s.size/1024/1024).toFixed(2)+" MB",uploaded_by:(await a.auth.getUser()).data.user.id});if(L)throw L;await a.from("activity_logs").insert({project_id:i.id,message:`Client uploaded file: ${s.name}`}),alert("File uploaded successfully!"),u()}catch(l){alert("Error uploading file: "+l.message)}finally{C(!1)}}},O=async(t,s)=>{if(d){p(m.map(n=>n.id===t?{...n,is_completed:!s}:n));return}p(m.map(n=>n.id===t?{...n,is_completed:!s}:n));const{error:l}=await a.from("tasks").update({is_completed:!s}).eq("id",t);l?(alert("Error updating task"),u()):s||await a.from("activity_logs").insert({project_id:i.id,message:"Client completed task."})},[M,b]=r.useState(!1),[c,E]=r.useState(null),[F,P]=r.useState(""),z=async t=>{if(t.preventDefault(),!(!c||!F))try{const{error:s}=await a.from("documents").update({status:"signed",signed_at:new Date().toISOString()}).eq("id",c.id);if(s)throw s;await a.from("activity_logs").insert({project_id:i.id,message:`Client digitally signed: ${c.name}`}),alert("Document signed successfully!"),b(!1),E(null),P(""),u()}catch(s){alert("Error signing document: "+s.message)}},I=t=>{E(t),b(!0)};if(g)return e.jsx("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center text-white",children:"Loading Project..."});const[o,h]=r.useState({full_name:"",company_name:"",phone:""});r.useEffect(()=>{!i&&!g&&R()},[i,g]);const R=async()=>{const{data:{user:t}}=await a.auth.getUser();if(t){const{data:s}=await a.from("profiles").select("*").eq("id",t.id).single();s&&h({full_name:s.full_name||"",company_name:s.company_name||"",phone:s.phone||""})}},H=async t=>{t.preventDefault();const{data:{user:s}}=await a.auth.getUser();if(!s)return;const{error:l}=await a.from("profiles").update({full_name:o.full_name,company_name:o.company_name,phone:o.phone}).eq("id",s.id);alert(l?"Error updating profile: "+l.message:"Profile updated successfully!")};if(!i)return e.jsx("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-slate-900 rounded-2xl border border-slate-800 p-8 shadow-2xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Welcome to Empower! ðŸš€"}),e.jsx("p",{className:"text-slate-400",children:"We're getting your dashboard ready. In the meantime, please complete your profile so we can set up your project correctly."})]}),e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Full Name"}),e.jsx("input",{type:"text",required:!0,className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500",value:o.full_name,onChange:t=>h({...o,full_name:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Company Name"}),e.jsx("input",{type:"text",className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500",placeholder:"e.g. Acme Corp",value:o.company_name,onChange:t=>h({...o,company_name:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Phone Number"}),e.jsx("input",{type:"tel",className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500",value:o.phone,onChange:t=>h({...o,phone:t.target.value})})]}),e.jsx("button",{type:"submit",className:"w-full bg-purple-600 text-white font-bold py-3 rounded-lg hover:bg-purple-700 transition-colors mt-4",children:"Save Details"})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-slate-800 text-center",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Need to sign out?"}),e.jsx("button",{onClick:D,className:"text-slate-400 hover:text-white transition-colors text-sm",children:"Logout"})]})]})});const U=m.filter(t=>t.type==="admin_task"),$=m.filter(t=>t.type==="client_task");return e.jsxs("div",{className:"min-h-screen bg-slate-950 pt-12 px-6 pb-12",children:[e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:i.name}),e.jsxs("p",{className:"text-slate-400 mt-2",children:["Status: ",e.jsx("span",{className:"text-empower-pink font-bold",children:i.status})]})]}),e.jsx("button",{onClick:D,className:"text-slate-400 hover:text-white transition-colors",children:"Logout"})]}),e.jsxs("div",{className:"flex gap-8 border-b border-slate-800 mb-8",children:[e.jsx("button",{onClick:()=>k("overview"),className:`pb-4 text-sm font-bold uppercase tracking-wider transition-colors ${x==="overview"?"text-empower-pink border-b-2 border-empower-pink":"text-slate-500 hover:text-slate-300"}`,children:"Overview"}),e.jsx("button",{onClick:()=>k("documents"),className:`pb-4 text-sm font-bold uppercase tracking-wider transition-colors ${x==="documents"?"text-empower-pink border-b-2 border-empower-pink":"text-slate-500 hover:text-slate-300"}`,children:"File Centre"})]}),x==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-slate-900 p-8 rounded-2xl border border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-amber-500/10 rounded-lg text-amber-500",children:e.jsx(W,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"My Action Plan"})]}),e.jsxs("div",{className:"space-y-4",children:[U.map(t=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-950/50 rounded-lg border border-slate-800/50",children:[t.is_completed?e.jsx(j,{className:"w-5 h-5 text-emerald-500 shrink-0"}):e.jsx(B,{className:"w-5 h-5 text-slate-600 shrink-0"}),e.jsx("span",{className:`text-sm ${t.is_completed?"text-slate-500 line-through":"text-slate-300"}`,children:t.title})]},t.id)),U.length===0&&e.jsx("p",{className:"text-slate-500 italic",children:"No actions listed yet."})]})]}),e.jsxs("div",{className:"bg-slate-900 p-8 rounded-2xl border border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-purple-500/10 rounded-lg text-purple-500",children:e.jsx(j,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Your Tasks"})]}),e.jsxs("div",{className:"space-y-4",children:[$.map(t=>e.jsxs("div",{onClick:()=>O(t.id,t.is_completed),className:"flex items-start gap-3 p-3 bg-slate-950/50 rounded-lg border border-slate-800/50 cursor-pointer hover:border-purple-500/50 transition-colors",children:[t.is_completed?e.jsx(j,{className:"w-5 h-5 text-emerald-500 shrink-0"}):e.jsx(B,{className:"w-5 h-5 text-purple-500 shrink-0"}),e.jsx("span",{className:`text-sm ${t.is_completed?"text-slate-500 line-through":"text-white"}`,children:t.title})]},t.id)),$.length===0&&e.jsx("p",{className:"text-slate-500 italic",children:"No tasks assigned to you."})]})]})]}),x==="documents"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-slate-900 p-8 rounded-2xl border border-slate-800",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-6",children:"Upload Files"}),e.jsxs("div",{className:"border-2 border-dashed border-slate-700 rounded-xl p-8 text-center hover:border-purple-500 transition-colors relative",children:[e.jsx("input",{type:"file",onChange:T,disabled:S,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"p-4 bg-slate-800 rounded-full",children:e.jsx(G,{className:"w-8 h-8 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium mb-1",children:S?"Uploading...":"Click or Drag to Upload"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Support for images, PDF, and docs"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-900 p-8 rounded-2xl border border-slate-800",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-6",children:"Shared Files"}),e.jsxs("div",{className:"space-y-3",children:[v.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-950/50 rounded-xl border border-slate-800 hover:border-slate-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${t.type==="link"?"bg-blue-500/10 text-blue-400":"bg-purple-500/10 text-purple-400"}`,children:t.type==="link"?e.jsx(A,{className:"w-5 h-5"}):e.jsx(Q,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-white font-medium text-sm",children:t.name}),t.status==="pending_signature"&&e.jsx("span",{className:"text-[10px] bg-amber-500/10 text-amber-500 px-2 py-0.5 rounded border border-amber-500/20 uppercase font-bold",children:"Sign Req."}),t.status==="signed"&&e.jsx("span",{className:"text-[10px] bg-emerald-500/10 text-emerald-500 px-2 py-0.5 rounded border border-emerald-500/20 uppercase font-bold",children:"Signed"})]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[t.type==="link"?"External Link":t.size," â€¢ ",new Date(t.created_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="pending_signature"&&e.jsx("button",{onClick:()=>I(t),className:"px-3 py-1 bg-amber-500 text-black text-xs font-bold rounded hover:bg-amber-400 transition-colors",children:"Sign"}),e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-slate-800 rounded-lg text-slate-400 hover:text-white transition-colors",children:t.type==="link"?e.jsx(A,{className:"w-4 h-4"}):e.jsx(Z,{className:"w-4 h-4"})})]})]},t.id)),v.length===0&&e.jsx("p",{className:"text-slate-500 italic",children:"No documents shared yet."})]})]})]})]}),M&&c&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-900 rounded-xl border border-slate-800 p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Digital Acceptance"}),e.jsxs("p",{className:"text-slate-400 text-sm mb-6",children:["By signing this document (",c.name,"), you agree to the terms and conditions outlined within it."]}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Type Full Name to Sign"}),e.jsx("input",{type:"text",required:!0,className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500 font-mono",placeholder:"e.g. Jane Doe",value:F,onChange:t=>P(t.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"px-4 py-2 text-slate-400 hover:text-white transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors font-bold",children:"Confirm & Sign"})]})]})]})})]})}export{ne as default};
