import{j as e}from"./jsx-runtime.ClP7wGfN.js";import{r}from"./index.DK-fsZOb.js";import{s as a}from"./supabase.CJZAYlQe.js";import{F as E}from"./file-text.BxmPbMHG.js";import{c as j}from"./createLucideIcon.BvVQPHGD.js";import{U}from"./upload.bV92bC9w.js";import{C as M}from"./circle-check-big.DIjgcCMq.js";import{C as F}from"./clock.CHCloknB.js";import{E as q}from"./external-link.CF0LS1WK.js";import{T as z}from"./trash-2.CxrQIgEI.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],$=j("file",A);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],b=j("link",P);function W({projectId:l}){const[N,y]=r.useState(!0),[i,w]=r.useState(null),[x,v]=r.useState([]),[c,u]=r.useState(!1),[k,m]=r.useState(!1),[n,p]=r.useState({name:"",url:""});r.useEffect(()=>{d()},[l]);const d=async()=>{const{data:t}=await a.from("projects").select("*, profiles(full_name, company_name, email)").eq("id",l).single();w(t);const{data:s}=await a.from("documents").select("*").eq("project_id",l).order("created_at",{ascending:!1});v(s||[]),y(!1)},_=async t=>{const s=t.target.files?.[0];if(s){u(!0);try{const o=s.name.split(".").pop(),D=`${Math.random()}.${o}`,h=`${l}/${D}`,{error:f}=await a.storage.from("portal-files").upload(h,s);if(f)throw f;const{data:{publicUrl:S}}=a.storage.from("portal-files").getPublicUrl(h),{error:g}=await a.from("documents").insert({project_id:l,name:s.name,url:S,type:"file",size:(s.size/1024/1024).toFixed(2)+" MB",uploaded_by:(await a.auth.getUser()).data.user?.id,status:"shared"});if(g)throw g;d()}catch(o){alert("Error uploading file: "+o.message)}finally{u(!1)}}},L=async t=>{t.preventDefault();try{const{error:s}=await a.from("documents").insert({project_id:l,name:n.name,url:n.url,type:"link",status:"shared",uploaded_by:(await a.auth.getUser()).data.user?.id});if(s)throw s;m(!1),p({name:"",url:""}),d()}catch(s){alert("Error adding link: "+s.message)}},C=async(t,s)=>{if(confirm("Are you sure you want to delete this item?"))try{await a.from("documents").delete().eq("id",t),d()}catch(o){alert("Error deleting item: "+o.message)}};return N?e.jsx("div",{className:"text-white",children:"Loading Project Details..."}):i?e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:i.name}),e.jsxs("div",{className:"flex items-center gap-4 text-slate-400",children:[e.jsx("span",{children:i.profiles?.full_name}),e.jsx("span",{children:"•"}),e.jsx("span",{children:i.profiles?.company_name}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"px-2 py-0.5 bg-emerald-500/10 text-emerald-500 rounded text-xs border border-emerald-500/20 uppercase font-bold",children:i.status})]})]})}),e.jsxs("div",{className:"bg-slate-900 rounded-xl border border-slate-800 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-slate-800 flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-purple-400"}),"File & Link Centre"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-700 transition-colors text-sm",children:[e.jsx(b,{className:"w-4 h-4"}),"Add Link"]}),e.jsxs("label",{className:`flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm cursor-pointer ${c?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(U,{className:"w-4 h-4"}),c?"Uploading...":"Upload File",e.jsx("input",{type:"file",className:"hidden",onChange:_,disabled:c})]})]})]}),e.jsx("div",{className:"p-6",children:x.length===0?e.jsx("p",{className:"text-slate-500 text-center py-8",children:"No files or links shared yet."}):e.jsx("div",{className:"space-y-3",children:x.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-950/50 rounded-xl border border-slate-800 hover:border-slate-700 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${t.type==="link"?"bg-blue-500/10 text-blue-400":"bg-purple-500/10 text-purple-400"}`,children:t.type==="link"?e.jsx(b,{className:"w-5 h-5"}):e.jsx($,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-white font-medium",children:t.name}),t.status==="signed"&&e.jsxs("span",{className:"px-2 py-0.5 bg-emerald-500/10 text-emerald-500 text-[10px] uppercase font-bold rounded border border-emerald-500/20 flex items-center gap-1",children:[e.jsx(M,{className:"w-3 h-3"})," Signed"]}),t.status==="pending_signature"&&e.jsxs("span",{className:"px-2 py-0.5 bg-amber-500/10 text-amber-500 text-[10px] uppercase font-bold rounded border border-amber-500/20 flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"})," Awaiting Sign"]})]}),e.jsxs("div",{className:"flex gap-3 text-xs text-slate-500 mt-1",children:[e.jsx("span",{children:new Date(t.created_at).toLocaleDateString()}),t.size&&e.jsxs("span",{children:["• ",t.size]}),t.signed_at&&e.jsxs("span",{children:["• Signed: ",new Date(t.signed_at).toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",title:"Open",children:e.jsx(q,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>C(t.id),className:"p-2 text-slate-400 hover:text-red-400 hover:bg-slate-800 rounded-lg transition-colors",title:"Delete",children:e.jsx(z,{className:"w-4 h-4"})})]})]},t.id))})})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-900 rounded-xl border border-slate-800 p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Add External Link"}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Link Name"}),e.jsx("input",{type:"text",required:!0,className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500",placeholder:"e.g. Google Drive Folder",value:n.name,onChange:t=>p({...n,name:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"URL"}),e.jsx("input",{type:"url",required:!0,className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500",placeholder:"https://...",value:n.url,onChange:t=>p({...n,url:t.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2 text-slate-400 hover:text-white transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-bold",children:"Add Link"})]})]})]})})]}):e.jsx("div",{className:"text-white",children:"Project not found."})}export{W as default};
